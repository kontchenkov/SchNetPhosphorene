# SchNetPhosphorene
Дополнительные материалы к статье
"Моделирование теплопроводности черного фосфорена с использованием глубокого обучения",
авторы Д.В. Завьялов, Д.Н. Жариков, В.И. Конченков, Д.В. Шеин

Установка и настройка пакета SchNet осуществляется согласно руководству
https://schnetpack.readthedocs.io/
Сам пакет schnetpack устанавливается в окружение schnetenv среды conda.
В этом окружении настраиваются все пакеты, необходимые для обучения сети.
Для использования обученной сети для вычисления потенциала межатомного взаимодействия
в ходе классической молекулярной динамики настраивается окружение spk_lammps.

1) В папке /out_cp должны лежать исходные данные для обучения - результаты моделирования черного фосфорена методом квантовой
молекулярной динамики Кара-Парринелло. Выборка содержит 100000 записей. Моделируется система из 16 атомов.
Эти данные размещены на Яндекс-диске, ссылка и перечень файлов - в текстовом файле.

2) Файл 0_prepare_data_files_100000.py содержит код для преобразования данных из файлов
    Ph.pos (координаты атомов),
    Ph.for (силы, действующие на каждый из атомов),
    Ph.evp (энергия системы атомов)
в формат NumPy (файлы Ph_pos.npy, Ph_for.npy, Ph_energy.npy). Эти файлы будут использоваться в дальнейшем
для формирования датасета.
Для запуска файла нужно активировать окружение schnetenv:
    conda activate schnetenv
Собственно запуск файла на исполнение осуществляется командой
    python 0_prepare_data_files_100000.py
   
3) Файл 1_prepare_database_100000.py с использованием данных из файлов Ph_pos.npy, Ph_for.npy, Ph_energy.npy
   базу данных dataset_100000_pbc.db, которая сохраняется в папке /forcetut. При формировании датасета
   учитываются периодические граничные условия.
   
5) Файл 2_start_learning_dataset_100000.py запускает обучение нейронной сети на данных,
хранящихся в датасете dataset_100000_pbc.db, в результате формируется модель phosphorene_model_256_9_1000_100000_pbc_gpu
(индекс 1000 обозначает количество эпох обучения, 9 - количество слоев взаимодействия, при обучении учитываются периодические
граничные условия).

6) Файл 3_calculate_original_forces_abs_values_100000.py служит для вычисления значения модулей сил, действующих на каждый из атомов,
на основе данных тестовой выборки (последние 5000 записей из 100000), по данным файлов Ph_pos.npy, Ph_for.npy (исходные данные).
Формируется файл lst_original_data_all_by_atoms_100000.npy.

7) Файл 3_calculate_model_forces_abs_values_100000.py служит для вычисления значения модулей сил, действующих на каждый из атомов,
на основе данных тестовой выборки (последние 5000 записей из 100000), при помощи модели phosphorene_model_256_9_1000_100000_pbc_gpu.
Формируется файл lst_model_data_all_by_atoms_100000.npy.

8) Файл 3_calculate_model_forces_abs_values_2000.py служит для вычисления значения модулей сил, действующих на каждый из атомов,
на основе данных тестовой выборки (последние 5000 записей из 100000), при помощи модели phosphorene_model_256_7_4000
(обучена по аналогии с моделью phosphorene_model_256_9_1000_100000_pbc_gpu, но вместо 1000 использовалось 4000 эпох обучения,
сеть содержит 7 слоев взаимодействия, обучение проводилось на выборке, содержащей 2000 записей, периодические граничные
условия не учитываются).
Формируется файл lst_model_data_all_by_atoms_2000.npy.

9) Файлы в папке lammps_files:
- phosphorene_model_256_7_4000 - модель потенциала межатомного взаимодействия, это тот же файл, как и в папке forcetut; для подключения этого потенциала
  в LAMMPS необходимо выполнить команду:
      spkdeploy phosphorene_model_256_7_4000 phosphorene_model
  После этого при указании во входных файлах LAMMPS следующих двух строк мы подключаем соответствующий потенциал
  ...
  pair_style	schnetpack
  pair_coeff	* * phosphorene_model 16
  ...
- th_x.in - входной файл LAMMPS, отвечающий за приведение системы к равновесию
- th_x_c.in - входной файд LAMMPS, отвечающий за моделирование разности температур в образце фосфорена

10) Файлы в папке QE_files:
- P.in - исходный файл для расчета методом квантовой молекулярной динамики Кара-Парринелло в пакете Quantum ESPRESSO (cp.x)
- P.pbe-nl-rrkjus_psl.1.0.0.UPF - файл псевдопотенциала для фосфора.

11) В папке learning_curves находятся данные о кривых обучения
- 2000_train.csv - кривые обучения на выборке из 2000 записей
- 2000_val.csv - кривые валидации на выборке из 2000 записей
- 100000_train.csv - кривые обучения на выборке из 100000 записей
- 100000_val.csv - кривые валидации на выборке из 100000 записей
  
12) Файл figures3_6.ipynb содержит код, выполняющий построение графиков, представленных на рис. 3-6
    
